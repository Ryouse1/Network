<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Network Dashboard</title>

<style>
body {
  background: #0d1117;
  color: #c9d1d9;
  font-family: monospace;
  padding: 20px;
}
h1 {
  color: #58a6ff;
}
.panel {
  background: #161b22;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 0 10px rgba(0,0,0,.4);
}
.key {
  color: #8b949e;
}
.value {
  color: #c9d1d9;
}
.good { color: #3fb950; }
.warn { color: #d29922; }
.bad  { color: #f85149; }
</style>
</head>
<body>

<h1>ğŸŒ Network / Device Dashboard</h1>

<div class="panel" id="net"></div>
<div class="panel" id="device"></div>
<div class="panel" id="local"></div>

<script>
const net = document.getElementById("net");
const device = document.getElementById("device");
const local = document.getElementById("local");

/* ------------------------
   ã‚°ãƒ­ãƒ¼ãƒãƒ«IP
------------------------- */
async function getGlobalIP() {
  try {
    const r = await fetch("https://api.ipify.org?format=json");
    return (await r.json()).ip;
  } catch {
    return "å–å¾—å¤±æ•—";
  }
}

/* ------------------------
   æ“¬ä¼¼Ping
------------------------- */
async function getPing() {
  const start = performance.now();
  try {
    await fetch("https://www.google.com/favicon.ico", { mode: "no-cors" });
    return Math.round(performance.now() - start);
  } catch {
    return null;
  }
}

/* ------------------------
   ãƒ­ãƒ¼ã‚«ãƒ«IPï¼ˆWebRTCï¼‰
------------------------- */
function getLocalIP() {
  return new Promise(resolve => {
    const ips = new Set();
    const pc = new RTCPeerConnection({ iceServers: [] });
    pc.createDataChannel("x");

    pc.createOffer()
      .then(o => pc.setLocalDescription(o))
      .catch(() => resolve({ status: "error" }));

    pc.onicecandidate = e => {
      if (!e || !e.candidate) return;
      const m = e.candidate.candidate.match(
        /([0-9]{1,3}(\.[0-9]{1,3}){3})/
      );
      if (m) ips.add(m[1]);
    };

    setTimeout(() => {
      if (ips.size > 0) {
        resolve({ status: "ok", ips: [...ips] });
      } else {
        resolve({ status: "blocked" });
      }
      pc.close();
    }, 3000);
  });
}

/* ------------------------
   è¡¨ç¤ºæ›´æ–°
------------------------- */
async function render() {
  const ip = await getGlobalIP();
  const ping = await getPing();

  net.innerHTML = `
<b>ğŸ“¡ Network</b><br>
<span class="key">Global IP</span>: <span class="value">${ip}</span><br>
<span class="key">Ping</span>: <span class="${ping < 50 ? 'good' : ping < 150 ? 'warn' : 'bad'}">
${ping ? ping + " ms" : "æ¸¬å®šå¤±æ•—"}
</span><br>
<span class="key">Online</span>: ${navigator.onLine ? "true" : "false"}<br>
<span class="key">Connection</span>: ${navigator.connection?.effectiveType || "unknown"}
`;

  device.innerHTML = `
<b>ğŸ’» Device</b><br>
<span class="key">OS</span>: ${navigator.platform}<br>
<span class="key">Browser</span>: ${navigator.userAgent}<br>
<span class="key">CPU Cores</span>: ${navigator.hardwareConcurrency}<br>
<span class="key">Memory</span>: ${navigator.deviceMemory || "?"} GB<br>
<span class="key">Language</span>: ${navigator.language}<br>
<span class="key">Screen</span>: ${screen.width} x ${screen.height}
`;

  const localIP = await getLocalIP();
  if (localIP.status === "ok") {
    local.innerHTML = `
<b>ğŸ  Local Network</b><br>
<span class="key">Local IP</span>:<br>
${localIP.ips.map(ip => `- ${ip}`).join("<br>")}
`;
  } else if (localIP.status === "blocked") {
    local.innerHTML = `
<b>ğŸ  Local Network</b><br>
<span class="warn">å–å¾—ä¸å¯ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ / mDNSï¼‰</span>
`;
  } else {
    local.innerHTML = `
<b>ğŸ  Local Network</b><br>
<span class="bad">å–å¾—ã‚¨ãƒ©ãƒ¼</span>
`;
  }
}

render();
setInterval(render, 5000); // Pingæ›´æ–°
</script>

</body>
</html>
